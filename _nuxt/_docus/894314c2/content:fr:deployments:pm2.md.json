{"key":"content:fr:deployments:pm2.md","generatedAt":"2022-03-15T12:18:23.406Z","mtime":"2022-03-15T12:18:23.401Z","slug":"pm2","title":"PM2","position":"999999990000","to":"/deployments/pm2","draft":false,"page":true,"language":"fr","template":"guide","description":"Comment déployer Nuxt avec le mode cluster PM2 activé ?","target":"Server","category":"deployment","logo":{"light":"/img/companies/square/light/pm2.png","dark":"/img/companies/square/dark/pm2.png"},"empty":false,"body":{"raw":"---\ntemplate: guide\ntitle: PM2\ndescription: Comment déployer Nuxt avec le mode cluster PM2 activé ?\ntarget: Server\ncategory: deployment\nlogo:\n  light: \"/img/companies/square/light/pm2.png\"\n  dark: \"/img/companies/square/dark/pm2.png\"\n---\n# Déployer Nuxt en utilisant PM2\n\nComment déployer Nuxt avec le mode cluster PM2 activé ?\n\n---\n\nLe déploiement à l'aide de [PM2](https://pm2.keymetrics.io/) (Process Manager 2) est une solution rapide et facile pour héberger votre application universelle Nuxt sur votre serveur ou votre VM.\n\nDans ce guide, nous construisons l'application localement et la servons via un fichier de configuration PM2 avec le mode cluster activé. Le mode cluster permet d'éviter les temps d'arrêt en permettant aux applications d'être mises à l'échelle sur plusieurs CPU.\n\n## Commencer\n\nAssurez-vous que pm2 est installé sur votre serveur. Si ce n'est pas le cas, installez-le simplement de façon globale à partir de yarn ou npm.\n\n```bash\n# yarn pm2 install\n$ sudo yarn global add pm2 --prefix /usr/local\n\n# npm pm2 install\n$ npm install pm2 -g\n```\n\n## Configurer votre application\n\nTout ce que vous devez ajouter à votre application universelle Nuxt pour la servir via PM2 est un fichier appelé `ecosystem.config.js`. Créez un nouveau fichier avec ce nom dans le répertoire racine de votre projet et ajoutez le contenu suivant :\n\n```javascript\nmodule.exports = {\n  apps: [\n    {\n      name: 'NuxtAppName',\n      exec_mode: 'cluster',\n      instances: 'max', // Ou un certain nombre d'instances\n      script: './node_modules/nuxt/bin/nuxt.js',\n      args: 'start'\n    }\n  ]\n}\n```\n\n## Créer et servir l'application\n\nMaintenant, construisez votre application avec `npm run build`.\n\nEt le servir avec `pm2 start`.\n\nVérifier le statut `pm2 ls`.\n\nVotre application Nuxt est maintenant en service !\n\n## Informations complémentaires\n\nCette solution garantit l'absence de temps d'arrêt pour votre application sur ce serveur. Vous devez éviter les pannes de serveur par la redondance ou par des solutions de haute disponibilité en cloud.\n\nVous pouvez trouver des configurations supplémentaires de PM2 [ici](https://pm2.keymetrics.io/docs/usage/application-declaration/#general).\n","ast":{"type":"root","children":[{"type":"element","tag":"prose-h1","props":{"class":"d-heading-title","id":"déployer-nuxt-en-utilisant-pm2"},"children":[{"type":"text","value":"Déployer Nuxt en utilisant PM2"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{"class":"d-heading-description"},"children":[{"type":"text","value":"Comment déployer Nuxt avec le mode cluster PM2 activé ?"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-hr","props":{"class":"d-heading-hr"},"children":[]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Le déploiement à l'aide de "},{"type":"element","tag":"prose-a","props":{"href":"https://pm2.keymetrics.io/","rel":["nofollow","noopener","noreferrer"],"target":"_blank"},"children":[{"type":"text","value":"PM2"}]},{"type":"text","value":" (Process Manager 2) est une solution rapide et facile pour héberger votre application universelle Nuxt sur votre serveur ou votre VM."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Dans ce guide, nous construisons l'application localement et la servons via un fichier de configuration PM2 avec le mode cluster activé. Le mode cluster permet d'éviter les temps d'arrêt en permettant aux applications d'être mises à l'échelle sur plusieurs CPU."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h2","props":{"id":"commencer"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#commencer"},"children":[{"type":"text","value":"Commencer"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Assurez-vous que pm2 est installé sur votre serveur. Si ce n'est pas le cas, installez-le simplement de façon globale à partir de yarn ou npm."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"pre","props":{"className":["line-numbers","language-bash"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"# yarn pm2 install"}]},{"type":"text","value":"\n$ "},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"sudo"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"yarn"}]},{"type":"text","value":" global "},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"add"}]},{"type":"text","value":" pm2 --prefix /usr/local\n\n"},{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"# npm pm2 install"}]},{"type":"text","value":"\n$ "},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"install"}]},{"type":"text","value":" pm2 -g\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h2","props":{"id":"configurer-votre-application"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#configurer-votre-application"},"children":[{"type":"text","value":"Configurer votre application"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Tout ce que vous devez ajouter à votre application universelle Nuxt pour la servir via PM2 est un fichier appelé "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"ecosystem.config.js"}]},{"type":"text","value":". Créez un nouveau fichier avec ce nom dans le répertoire racine de votre projet et ajoutez le contenu suivant :"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"pre","props":{"className":["line-numbers","language-javascript"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"module"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"className":["token","property-access"]},"children":[{"type":"text","value":"exports"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  apps"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":"\n    "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n      name"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'NuxtAppName'"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n      exec_mode"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'cluster'"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n      instances"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'max'"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"// Ou un certain nombre d'instances"}]},{"type":"text","value":"\n      script"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'./node_modules/nuxt/bin/nuxt.js'"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n      args"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'start'"}]},{"type":"text","value":"\n    "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h2","props":{"id":"créer-et-servir-lapplication"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#cr%C3%A9er-et-servir-lapplication"},"children":[{"type":"text","value":"Créer et servir l'application"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Maintenant, construisez votre application avec "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"npm run build"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Et le servir avec "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"pm2 start"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Vérifier le statut "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"pm2 ls"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Votre application Nuxt est maintenant en service !"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h2","props":{"id":"informations-complémentaires"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#informations-compl%C3%A9mentaires"},"children":[{"type":"text","value":"Informations complémentaires"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Cette solution garantit l'absence de temps d'arrêt pour votre application sur ce serveur. Vous devez éviter les pannes de serveur par la redondance ou par des solutions de haute disponibilité en cloud."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Vous pouvez trouver des configurations supplémentaires de PM2 "},{"type":"element","tag":"prose-a","props":{"href":"https://pm2.keymetrics.io/docs/usage/application-declaration/#general","rel":["nofollow","noopener","noreferrer"],"target":"_blank"},"children":[{"type":"text","value":"ici"}]},{"type":"text","value":"."}]}]},"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"commencer","depth":2,"text":"Commencer"},{"id":"configurer-votre-application","depth":2,"text":"Configurer votre application"},{"id":"créer-et-servir-lapplication","depth":2,"text":"Créer et servir l'application"},{"id":"informations-complémentaires","depth":2,"text":"Informations complémentaires"}]}}}