{"key":"content:fr:docs:3.features:10.live-preview.md","generatedAt":"2022-03-15T12:18:24.099Z","mtime":"2022-03-15T12:18:24.091Z","slug":"live-preview","title":"Mode de prévisualisation","position":"999900030010","to":"/docs/features/live-preview","draft":false,"page":true,"language":"fr","description":"Prévisualisation en temps réel pour une génération statique avec le mode de prévisualisation","category":"features","empty":false,"body":{"raw":"---\ntitle: Mode de prévisualisation\ndescription: Prévisualisation en temps réel pour une génération statique avec le mode de prévisualisation\ncategory: features\n---\n# Mode de prévisualisation\n\nAvec Nuxt et une génération axée sur de l'intégralement statique, nous pouvons maintenant utiliser la prévisualisation en temps réel, sans configuration additionnelle. Cela nous permettra d'appeler notre API ou notre CMS afin que nous puissions voir les changements avant de déployer.\n\n---\n\n::alert{type=\"info\"}\n\nSeulement disponible dans le cas d'un [target:static](/docs/features/deployment-targets#static-hosting)\n\n::\n\nLe mode de prévisualisation va s'occuper de rafraîchir automatiquement la data de la page vu qu'il utilise `$nuxt.refresh` (et donc fait les appels de `nuxtServerInit`, `asyncData` et `fetch`) du côté client.\n\nPour activer la prévisualisation en temps réel, il faudra ajouter le plugin suivant:\n\n```js{}[plugins/preview.client.js]\nexport default function ({ query, enablePreview }) {\n  if (query.preview) {\n    enablePreview()\n  }\n}\n```\n\n::alert{type=\"info\"}\n\n`EnablePreview` est seulement disponible dans l'objet contexte des plugins. Les prévisualisations sont gérées côté client et donc, le plugin doit s'exécuter sur le client: `preview.client.js`\n\n::\n\n```js{}[nuxt.config.js]\nexport default {\n  plugins: ['~/plugins/preview.client.js']\n}\n```\n\nUne fois que l'on a ajouté le plugin, on peut maintenant générer et servir notre site.\n\n::code-group\n```bash [Yarn]\nyarn generate\nyarn start\n```\n```bash [NPM]\nnpm run generate\nnpm run start\n```\n::\n\nNous pouvons maintenant voir la page de prévisualisation en ajoutant une query param à la fin de la page qui nous intéresse:\n\n```js\n?preview=true\n```\n\n::alert{type=\"info\"}\n\n`enablePreview` doit être testé localement avec `yarn start` et non `yarn dev`\n\n::\n\n### Prévisualiser les pages qui ne sont pas encore générées\n\nPour les pages qui ne sont pas encore générées, la solution de rechange de la SPA va continuer de s'occuper de faire un appel à l'API avant de montrer une page 404 vu que ces pages existent sur l'API mais ne sont pas encore générées.\n\nSi nous avons configuré un crochet de validation (webhook), on aura sans doute besoin de le modifier afin d'accommoder le fait qu'il ne redirige plus vers une 404 en mode de prévisualisation.\n\n```js\nvalidate({ params, query }) {\n  if (query.preview) {\n    return true\n}\n```\n\n### Passer la data à enablePreview\n\nOn peut passer de la data à la fonction `enablePreview`. La data sera ainsi disponible sur le helper de contexte `$preview` et sur `this.$preview`.\n\n### Et ensuite ?\n\n::alert{type=\"next\"}\n\nSe référer au [document sur la structure des répertoires](/docs/directory-structure/nuxt).\n\n::\n","ast":{"type":"root","children":[{"type":"element","tag":"prose-h1","props":{"class":"d-heading-title","id":"mode-de-prévisualisation"},"children":[{"type":"text","value":"Mode de prévisualisation"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{"class":"d-heading-description"},"children":[{"type":"text","value":"Avec Nuxt et une génération axée sur de l'intégralement statique, nous pouvons maintenant utiliser la prévisualisation en temps réel, sans configuration additionnelle. Cela nous permettra d'appeler notre API ou notre CMS afin que nous puissions voir les changements avant de déployer."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-hr","props":{"class":"d-heading-hr"},"children":[]},{"type":"text","value":"\n"},{"type":"element","tag":"alert","props":{"type":"info"},"children":[{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Seulement disponible dans le cas d'un "},{"type":"element","tag":"prose-a","props":{"href":"/docs/features/deployment-targets#static-hosting"},"children":[{"type":"text","value":"target:static"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Le mode de prévisualisation va s'occuper de rafraîchir automatiquement la data de la page vu qu'il utilise "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"$nuxt.refresh"}]},{"type":"text","value":" (et donc fait les appels de "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"nuxtServerInit"}]},{"type":"text","value":", "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"asyncData"}]},{"type":"text","value":" et "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"fetch"}]},{"type":"text","value":") du côté client."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Pour activer la prévisualisation en temps réel, il faudra ajouter le plugin suivant:"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"plugins/preview.client.js"}]},{"type":"element","tag":"pre","props":{"className":["line-numbers","language-js"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"export"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"default"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","keyword"]},"children":[{"type":"text","value":"function"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"className":["token","parameter"]},"children":[{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" query"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" enablePreview "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"span","props":{"className":["token","keyword","control-flow"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"query"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"className":["token","property-access"]},"children":[{"type":"text","value":"preview"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"enablePreview"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"alert","props":{"type":"info"},"children":[{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"EnablePreview"}]},{"type":"text","value":" est seulement disponible dans l'objet contexte des plugins. Les prévisualisations sont gérées côté client et donc, le plugin doit s'exécuter sur le client: "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"preview.client.js"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"nuxt.config.js"}]},{"type":"element","tag":"pre","props":{"className":["line-numbers","language-js"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"export"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"default"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  plugins"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'~/plugins/preview.client.js'"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Une fois que l'on a ajouté le plugin, on peut maintenant générer et servir notre site."}]},{"type":"text","value":"\n"},{"type":"element","tag":"code-group","props":{},"children":[{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"Yarn"}]},{"type":"element","tag":"pre","props":{"className":["line-numbers","language-bash"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"yarn"}]},{"type":"text","value":" generate\n"},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"yarn"}]},{"type":"text","value":" start\n"}]}]}]},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"NPM"}]},{"type":"element","tag":"pre","props":{"className":["line-numbers","language-bash"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" run generate\n"},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" run start\n"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Nous pouvons maintenant voir la page de prévisualisation en ajoutant une query param à la fin de la page qui nous intéresse:"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"pre","props":{"className":["line-numbers","language-js"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":"?"}]},{"type":"text","value":"preview"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"className":["token","boolean"]},"children":[{"type":"text","value":"true"}]},{"type":"text","value":"\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"alert","props":{"type":"info"},"children":[{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"enablePreview"}]},{"type":"text","value":" doit être testé localement avec "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"yarn start"}]},{"type":"text","value":" et non "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"yarn dev"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h3","props":{"id":"prévisualiser-les-pages-qui-ne-sont-pas-encore-générées"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#pr%C3%A9visualiser-les-pages-qui-ne-sont-pas-encore-g%C3%A9n%C3%A9r%C3%A9es"},"children":[{"type":"text","value":"Prévisualiser les pages qui ne sont pas encore générées"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Pour les pages qui ne sont pas encore générées, la solution de rechange de la SPA va continuer de s'occuper de faire un appel à l'API avant de montrer une page 404 vu que ces pages existent sur l'API mais ne sont pas encore générées."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Si nous avons configuré un crochet de validation (webhook), on aura sans doute besoin de le modifier afin d'accommoder le fait qu'il ne redirige plus vers une 404 en mode de prévisualisation."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"pre","props":{"className":["line-numbers","language-js"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"validate"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"className":["token","parameter"]},"children":[{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" params"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" query "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"span","props":{"className":["token","keyword","control-flow"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"query"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"className":["token","property-access"]},"children":[{"type":"text","value":"preview"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tag":"span","props":{"className":["token","keyword","control-flow"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","boolean"]},"children":[{"type":"text","value":"true"}]},{"type":"text","value":"\n"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h3","props":{"id":"passer-la-data-à-enablepreview"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#passer-la-data-%C3%A0-enablepreview"},"children":[{"type":"text","value":"Passer la data à enablePreview"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"On peut passer de la data à la fonction "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"enablePreview"}]},{"type":"text","value":". La data sera ainsi disponible sur le helper de contexte "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"$preview"}]},{"type":"text","value":" et sur "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"this.$preview"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h3","props":{"id":"et-ensuite-"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#et-ensuite-"},"children":[{"type":"text","value":"Et ensuite ?"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"alert","props":{"type":"next"},"children":[{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Se référer au "},{"type":"element","tag":"prose-a","props":{"href":"/docs/directory-structure/nuxt"},"children":[{"type":"text","value":"document sur la structure des répertoires"}]},{"type":"text","value":"."}]}]}]},"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"prévisualiser-les-pages-qui-ne-sont-pas-encore-générées","depth":3,"text":"Prévisualiser les pages qui ne sont pas encore générées"},{"id":"passer-la-data-à-enablepreview","depth":3,"text":"Passer la data à enablePreview"},{"id":"et-ensuite-","depth":3,"text":"Et ensuite ?"}]}}}