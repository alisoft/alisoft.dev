{"key":"content:ja:docs:3.features:11.live-preview.md","generatedAt":"2022-03-15T12:18:29.312Z","mtime":"2022-03-15T12:18:29.306Z","slug":"live-preview","title":"プレビューモード","position":"999900030011","to":"/docs/features/live-preview","draft":false,"page":true,"language":"ja","description":"プレビューモードを使った静的ホスティング向けのライブプレビュー","category":"features","empty":false,"body":{"raw":"---\ntitle: プレビューモード\ndescription: プレビューモードを使った静的ホスティング向けのライブプレビュー\ncategory: features\n---\n# プレビューモード\n\nプレビューモードを使った静的ホスティング向けのライブプレビュー\n\n---\nNuxt とフルスタティックモジュールを使うことで、API や CMS を呼び出すライブプレビューをすぐに利用することができます。そして、デプロイする前に変化を確認することができます。\n\n::alert{type=\"warning\"}\n[`target:static`](/docs/features/deployment-targets#static-hosting) を利用しているときのみ使用可能です\n::\n\n内部では `$nuxt.refresh` を使っており、クライアントサイドで nuxtServerInit や asyncData、fetch を呼び出しているため、プレビューモードでは自動的にページのデータが更新されます。\n\nライブプレビューを有効化するためには、次のプラグインを追加する必要があります：\n\n```js{}[plugins/preview.client.js]\nexport default function ({ query, enablePreview }) {\n  if (query.preview) {\n    enablePreview()\n  }\n}\n```\n\n::alert{type=\"warning\"}\n`enablePreview` はプラグインの context オブジェクトでのみ利用可能です。プレビューはクライアントサイドで処理されるため、プラグイン(今回の例では preview.client.js)はクライアントでのみ実行される必要があります。\n::\n\n```js{}[nuxt.config.js]\nexport default {\n  plugins: ['~/plugins/preview.client.js']\n}\n```\n\n一度そのプラグインを追加すれば、すぐにサイトを生成し配信することができます。\n\n::code-group\n```bash [Yarn]\nyarn generate\nyarn start\n```\n```bash [NPX]\nnpx nuxt generate\nnpx nuxt start\n```\n::\n\nそして以下のクエリパラメータを確認したいページの最後に追加することでプレビューを見ることができます：\n\n```js\n?preview=true\n```\n\n::alert{type=\"warning\"}\nenablePreview は yarn dev ではなく yarn start を用いてローカルでテストしてください。\n::\n\n### まだ生成されていないページをプレビューする場合\n\nまだ生成されていないページは API 上に存在しますが静的なページとして生成されてはいないため、SPA フォールバックは 404 ページを表示する前に API を呼び出します。\n\nもし validate フックを設定している場合、プレビューモードで 404 ページへリダイレクトしないように validate フックを修正する必要があるでしょう。\n\n```js\nvalidate({ params, query }) {\n  if (query.preview) {\n    return true\n}\n```\n\n### enablePreview にデータを渡す場合\n\n`enablePreview` 関数にデータを渡すことができます。 そのデータは `$preview` コンテキストヘルパーと `this.$preview` で利用できます。\n\n### この次は？\n\n::alert{type=\"next\"}\n[ディレクトリ構造のドキュメント](/docs/directory-structure/nuxt)について確認しましょう。\n::\n","ast":{"type":"root","children":[{"type":"element","tag":"prose-h1","props":{"class":"d-heading-title","id":"プレビューモード"},"children":[{"type":"text","value":"プレビューモード"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{"class":"d-heading-description"},"children":[{"type":"text","value":"プレビューモードを使った静的ホスティング向けのライブプレビュー"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-hr","props":{"class":"d-heading-hr"},"children":[]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Nuxt とフルスタティックモジュールを使うことで、API や CMS を呼び出すライブプレビューをすぐに利用することができます。そして、デプロイする前に変化を確認することができます。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"alert","props":{"type":"warning"},"children":[{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"element","tag":"prose-a","props":{"href":"/docs/features/deployment-targets#static-hosting"},"children":[{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"target:static"}]}]},{"type":"text","value":" を利用しているときのみ使用可能です"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"内部では "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"$nuxt.refresh"}]},{"type":"text","value":" を使っており、クライアントサイドで nuxtServerInit や asyncData、fetch を呼び出しているため、プレビューモードでは自動的にページのデータが更新されます。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"ライブプレビューを有効化するためには、次のプラグインを追加する必要があります："}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"plugins/preview.client.js"}]},{"type":"element","tag":"pre","props":{"className":["line-numbers","language-js"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"export"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"default"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","keyword"]},"children":[{"type":"text","value":"function"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"className":["token","parameter"]},"children":[{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" query"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" enablePreview "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"span","props":{"className":["token","keyword","control-flow"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"query"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"className":["token","property-access"]},"children":[{"type":"text","value":"preview"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"enablePreview"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"alert","props":{"type":"warning"},"children":[{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"enablePreview"}]},{"type":"text","value":" はプラグインの context オブジェクトでのみ利用可能です。プレビューはクライアントサイドで処理されるため、プラグイン(今回の例では preview.client.js)はクライアントでのみ実行される必要があります。"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"nuxt.config.js"}]},{"type":"element","tag":"pre","props":{"className":["line-numbers","language-js"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"export"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"default"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  plugins"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'~/plugins/preview.client.js'"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"一度そのプラグインを追加すれば、すぐにサイトを生成し配信することができます。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"code-group","props":{},"children":[{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"Yarn"}]},{"type":"element","tag":"pre","props":{"className":["line-numbers","language-bash"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"yarn"}]},{"type":"text","value":" generate\n"},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"yarn"}]},{"type":"text","value":" start\n"}]}]}]},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"NPX"}]},{"type":"element","tag":"pre","props":{"className":["line-numbers","language-bash"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"npx nuxt generate\nnpx nuxt start\n"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"そして以下のクエリパラメータを確認したいページの最後に追加することでプレビューを見ることができます："}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"pre","props":{"className":["line-numbers","language-js"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":"?"}]},{"type":"text","value":"preview"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"className":["token","boolean"]},"children":[{"type":"text","value":"true"}]},{"type":"text","value":"\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"alert","props":{"type":"warning"},"children":[{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"enablePreview は yarn dev ではなく yarn start を用いてローカルでテストしてください。"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h3","props":{"id":"まだ生成されていないページをプレビューする場合"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#%E3%81%BE%E3%81%A0%E7%94%9F%E6%88%90%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%E3%83%9A%E3%83%BC%E3%82%B8%E3%82%92%E3%83%97%E3%83%AC%E3%83%93%E3%83%A5%E3%83%BC%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88"},"children":[{"type":"text","value":"まだ生成されていないページをプレビューする場合"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"まだ生成されていないページは API 上に存在しますが静的なページとして生成されてはいないため、SPA フォールバックは 404 ページを表示する前に API を呼び出します。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"もし validate フックを設定している場合、プレビューモードで 404 ページへリダイレクトしないように validate フックを修正する必要があるでしょう。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"pre","props":{"className":["line-numbers","language-js"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"validate"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"className":["token","parameter"]},"children":[{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" params"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" query "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"span","props":{"className":["token","keyword","control-flow"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"query"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"className":["token","property-access"]},"children":[{"type":"text","value":"preview"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tag":"span","props":{"className":["token","keyword","control-flow"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","boolean"]},"children":[{"type":"text","value":"true"}]},{"type":"text","value":"\n"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h3","props":{"id":"enablepreview-にデータを渡す場合"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#enablepreview-%E3%81%AB%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E6%B8%A1%E3%81%99%E5%A0%B4%E5%90%88"},"children":[{"type":"text","value":"enablePreview にデータを渡す場合"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"enablePreview"}]},{"type":"text","value":" 関数にデータを渡すことができます。 そのデータは "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"$preview"}]},{"type":"text","value":" コンテキストヘルパーと "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"this.$preview"}]},{"type":"text","value":" で利用できます。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h3","props":{"id":"この次は？"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#%E3%81%93%E3%81%AE%E6%AC%A1%E3%81%AF%EF%BC%9F"},"children":[{"type":"text","value":"この次は？"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"alert","props":{"type":"next"},"children":[{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"element","tag":"prose-a","props":{"href":"/docs/directory-structure/nuxt"},"children":[{"type":"text","value":"ディレクトリ構造のドキュメント"}]},{"type":"text","value":"について確認しましょう。"}]}]}]},"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"まだ生成されていないページをプレビューする場合","depth":3,"text":"まだ生成されていないページをプレビューする場合"},{"id":"enablepreview-にデータを渡す場合","depth":3,"text":"enablePreview にデータを渡す場合"},{"id":"この次は？","depth":3,"text":"この次は？"}]}}}