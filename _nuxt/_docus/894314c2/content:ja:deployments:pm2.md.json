{"key":"content:ja:deployments:pm2.md","generatedAt":"2022-03-15T12:18:28.699Z","mtime":"2022-03-15T12:18:28.690Z","slug":"pm2","title":"PM2","position":"999999990000","to":"/deployments/pm2","draft":false,"page":true,"language":"ja","template":"guide","description":"PM2 クラスタモードの有効によって Nuxt をどうやってデプロイするのか？","target":"Server","category":"deployment","logo":{"light":"/img/companies/square/light/pm2.png","dark":"/img/companies/square/dark/pm2.png"},"empty":false,"body":{"raw":"---\ntemplate: guide\ntitle: PM2\ndescription: PM2 クラスタモードの有効によって Nuxt をどうやってデプロイするのか？\ntarget: Server\ncategory: deployment\nlogo:\n  light: \"/img/companies/square/light/pm2.png\"\n  dark: \"/img/companies/square/dark/pm2.png\"\n---\n# PM2 を使った Nuxt のデプロイ\n\nPM2 クラスタモードの有効によって Nuxt をどうやってデプロイするのか？\n\n---\n\n[PM2](https://pm2.keymetrics.io/)(Process Manager 2)を使用したデプロイは、ユニバーサルな Nuxt アプリケーションをサーバーや VM にホスティングするための、迅速で簡単なソリューションです。\n\nこのガイドでは、アプリケーションをローカルに構築し、クラスタモードを有効にした PM2 の設定ファイルを使って提供します。クラスタモードでは、アプリケーションを複数の CPU にまたがって拡張することができるため、ダウンタイムを防ぐことができます。\n\n## はじめに\n\nサーバーに pm2 がインストールされていることを確認してください。インストールされていない場合は、yarn や npm からグローバルにインストールしてください。\n\n```bash\n# yarn で pm2 をインストール\n$ sudo yarn global add pm2 --prefix /usr/local\n\n# npm で pm2 をインストール\n$ npm install pm2 -g\n```\n\n## アプリケーションの設定\n\nPM2 でユニバーサル Nuxt アプリケーションを提供するために追加する必要があるのは、`ecosystem.config.js` というファイルです。プロジェクトのルートディレクトリに、この名前のファイルを新規に作成し、以下の内容を追加してください：\n\n```javascript\nmodule.exports = {\n  apps: [\n    {\n      name: 'NuxtAppName',\n      exec_mode: 'cluster',\n      instances: 'max', // またはインスタンスの数\n      script: './node_modules/nuxt/bin/nuxt.js',\n      args: 'start'\n    }\n  ]\n}\n```\n## アプリケーションのビルドと提供\n\n次に、`npm run build` でアプリをビルドします。\n\nそして、`pm2 start` でアプリをサーブします。\n\nステータスを確認するには `pm2 ls` とします。\n\nNuxt アプリケーションが提供されました!\n\n## さらなる情報\n\nこのソリューションは、このサーバー上のアプリケーションのダウンタイムがないことを保証します。(また、冗長化や高可用性クラウドソリューションによって、サーバーの故障を防ぐ必要があります)。\n\nPM2 の追加設定は[こちら](https://pm2.keymetrics.io/docs/usage/application-declaration/#general)からご覧いただけます。\n","ast":{"type":"root","children":[{"type":"element","tag":"prose-h1","props":{"class":"d-heading-title","id":"pm2-を使った-nuxt-のデプロイ"},"children":[{"type":"text","value":"PM2 を使った Nuxt のデプロイ"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{"class":"d-heading-description"},"children":[{"type":"text","value":"PM2 クラスタモードの有効によって Nuxt をどうやってデプロイするのか？"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-hr","props":{"class":"d-heading-hr"},"children":[]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"element","tag":"prose-a","props":{"href":"https://pm2.keymetrics.io/","rel":["nofollow","noopener","noreferrer"],"target":"_blank"},"children":[{"type":"text","value":"PM2"}]},{"type":"text","value":"(Process Manager 2)を使用したデプロイは、ユニバーサルな Nuxt アプリケーションをサーバーや VM にホスティングするための、迅速で簡単なソリューションです。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"このガイドでは、アプリケーションをローカルに構築し、クラスタモードを有効にした PM2 の設定ファイルを使って提供します。クラスタモードでは、アプリケーションを複数の CPU にまたがって拡張することができるため、ダウンタイムを防ぐことができます。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h2","props":{"id":"はじめに"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"},"children":[{"type":"text","value":"はじめに"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"サーバーに pm2 がインストールされていることを確認してください。インストールされていない場合は、yarn や npm からグローバルにインストールしてください。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"pre","props":{"className":["line-numbers","language-bash"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"# yarn で pm2 をインストール"}]},{"type":"text","value":"\n$ "},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"sudo"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"yarn"}]},{"type":"text","value":" global "},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"add"}]},{"type":"text","value":" pm2 --prefix /usr/local\n\n"},{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"# npm で pm2 をインストール"}]},{"type":"text","value":"\n$ "},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"install"}]},{"type":"text","value":" pm2 -g\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h2","props":{"id":"アプリケーションの設定"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E8%A8%AD%E5%AE%9A"},"children":[{"type":"text","value":"アプリケーションの設定"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"PM2 でユニバーサル Nuxt アプリケーションを提供するために追加する必要があるのは、"},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"ecosystem.config.js"}]},{"type":"text","value":" というファイルです。プロジェクトのルートディレクトリに、この名前のファイルを新規に作成し、以下の内容を追加してください："}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"pre","props":{"className":["line-numbers","language-javascript"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"module"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"className":["token","property-access"]},"children":[{"type":"text","value":"exports"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  apps"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":"\n    "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n      name"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'NuxtAppName'"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n      exec_mode"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'cluster'"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n      instances"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'max'"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"// またはインスタンスの数"}]},{"type":"text","value":"\n      script"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'./node_modules/nuxt/bin/nuxt.js'"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n      args"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'start'"}]},{"type":"text","value":"\n    "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h2","props":{"id":"アプリケーションのビルドと提供"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E3%83%93%E3%83%AB%E3%83%89%E3%81%A8%E6%8F%90%E4%BE%9B"},"children":[{"type":"text","value":"アプリケーションのビルドと提供"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"次に、"},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"npm run build"}]},{"type":"text","value":" でアプリをビルドします。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"そして、"},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"pm2 start"}]},{"type":"text","value":" でアプリをサーブします。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"ステータスを確認するには "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"pm2 ls"}]},{"type":"text","value":" とします。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Nuxt アプリケーションが提供されました!"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h2","props":{"id":"さらなる情報"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#%E3%81%95%E3%82%89%E3%81%AA%E3%82%8B%E6%83%85%E5%A0%B1"},"children":[{"type":"text","value":"さらなる情報"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"このソリューションは、このサーバー上のアプリケーションのダウンタイムがないことを保証します。(また、冗長化や高可用性クラウドソリューションによって、サーバーの故障を防ぐ必要があります)。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"PM2 の追加設定は"},{"type":"element","tag":"prose-a","props":{"href":"https://pm2.keymetrics.io/docs/usage/application-declaration/#general","rel":["nofollow","noopener","noreferrer"],"target":"_blank"},"children":[{"type":"text","value":"こちら"}]},{"type":"text","value":"からご覧いただけます。"}]}]},"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"はじめに","depth":2,"text":"はじめに"},{"id":"アプリケーションの設定","depth":2,"text":"アプリケーションの設定"},{"id":"アプリケーションのビルドと提供","depth":2,"text":"アプリケーションのビルドと提供"},{"id":"さらなる情報","depth":2,"text":"さらなる情報"}]}}}