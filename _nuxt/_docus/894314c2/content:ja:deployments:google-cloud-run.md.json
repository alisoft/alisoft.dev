{"key":"content:ja:deployments:google-cloud-run.md","generatedAt":"2022-03-15T12:18:28.647Z","mtime":"2022-03-15T12:18:28.641Z","slug":"google-cloud-run","title":"Google Cloud Run","position":"999999990000","to":"/deployments/google-cloud-run","draft":false,"page":true,"language":"ja","template":"guide","description":"Nuxt を Google Cloud Run にどうやってデプロイするのか？","target":"Server","category":"deployment","logo":{"light":"/img/companies/square/light/Google_Cloud_run.svg","dark":"/img/companies/square/dark/Google_Cloud_run.svg"},"empty":false,"body":{"raw":"---\ntemplate: guide\ntitle: Google Cloud Run\ndescription: Nuxt を Google Cloud Run にどうやってデプロイするのか？\ntarget: Server\ncategory: deployment\nlogo:\n  light: \"/img/companies/square/light/Google_Cloud_run.svg\"\n  dark: \"/img/companies/square/dark/Google_Cloud_run.svg\"\n---\n# Nuxt を Google Cloud Run へデプロイする\n\nNuxt を Google Cloud Run にどうやってデプロイするのか？\n\n---\n\n[Google Cloud Run](https://cloud.google.com/run) はコンテナ化されたアプリケーションを迅速に安全にデプロイし、スケーリングするためのフルマネージド・コンピュータ・プラットフォームです。\n\nこのガイドでは、簡単にプロジェクトのフォルダ全体を Dockerfile で Google Cloud Build にアップロードします。アップロードした後、Cloud Build は自動でコンテナを生成します。そしてコンテナを package.json の `start` スクリプトで起動する、Google Cloud Run にデプロイします。\n## はじめに\n\nGoogle Cloud Account とプロジェクト、そしてエディターとして Cloud Build と Cloud Run にアクセス権があることを確認してください。さらに Google の[こちら](https://cloud.google.com/sdk/)で解説されている Cloud SDK (CLI) をダウンロードしてインストールし、Google Cloud Account でログインしてください。もし Cloud SDK をダウンロードしたくない場合、Google Cloud Console から gcloud CLI を使用することができます。\n\nいくつかチェックをしましょう！\n\nCloud Build API と Cloud Run API が無効の場合、有効にします：\n\n```bash\n# Cloud Build を有効にする\n$ gcloud services enable cloudbuild.googleapis.com\n\n# Cloud Run を有効にする\n$ gcloud services enable run.googleapis.com\n```\n\nGo in your application directory and install dependencies:\n\n```bash\n# yarn ユーザー向け\n$ yarn\n\n# npm ユーザー向け\n$ npm install\n```\n\nStart the application locally:\n\n```bash\n# yarn ユーザー向け\n$ yarn dev\n\n# npm ユーザー向け\n$ npm run dev\n```\n\n全ての動作を確認します。\n\n## アプリケーションのコンテナ化\n\nそれでは、Cloud Build でコンテナを作成します。\n\nNuxt アプリケーションに `Dockerfile` を追加する必要があります。 プロジェクトのルートディレクトリに `Dockerfile` という名前の新しいファイルを作成し、以下の内容を追加してください：\n\nyarn ユーザー向け：\n\n```Dockerfile\nFROM node:14\n\nWORKDIR /usr/src/app\n\nCOPY . ./\nRUN yarn\n\nEXPOSE 8080\n\nENV HOST=0.0.0.0\nENV PORT=8080\n\nRUN yarn build\n\nCMD [ \"yarn\", \"start\" ]\n```\n\nnpm ユーザー向け：\n\n```Dockerfile\nFROM node:14\n\nWORKDIR /usr/src/app\n\nCOPY . ./\nRUN npm install\n\nEXPOSE 8080\n\nENV HOST=0.0.0.0\nENV PORT=8080\n\nRUN npm run build\n\nCMD [ \"npm\", \"run\", \"start\" ]\n```\n\nビルドプロセスを開始するため、以下のコマンドを実行してください：\n\n`gcloud builds submit --tag gcr.io/<YOUR_GOOGLE_CLOUD_PROJECT_ID>/my-nuxt-app-name:1.0.0 .`\n\n!注意: もし継続的デリバリーや .env ファイルでの設定を実装したい場合、[Cloud Build 構成ファイル](https://cloud.google.com/cloud-build/docs/build-config) を使用する必要があります。\n\n## Cloud Run へのアプリケーションのデプロイ\n\nアプリケーションをデプロイするため以下のコマンドを実行してください：\n\n`gcloud run deploy --image=gcr.io/<YOUR_GOOGLE_CLOUD_PROJECT_ID>/my-nuxt-app-name:1.0.0 --platform managed --port 3000`\n\nパブリックアクセスの設定を行いたい場合、認証されていない起動を許可します。\n\nCloud Run アプリケーションのデフォルトの同時実行値は 80 であることに注意してください（各コンテナ・インスタンスは、一度に最大 80 のリクエストを処理します）。このようにして同時実行値を指定することができます：\n\n`gcloud run deploy --image=gcr.io/<YOUR_GOOGLE_CLOUD_PROJECT_ID>/my-nuxt-app-name:1.0.0 --platform managed --port 3000 --concurrency <YOUR_CONCURRENCY_VALUE>`\n\nデプロイメントの作成に成功しているか確認するため、以下のコマンドを実行してください：\n\n`gcloud run services list --platform managed`\n\nCloud Run サービスのリストが表示されます。デプロイした URL をクリックし、結果をお楽しみください！\n","ast":{"type":"root","children":[{"type":"element","tag":"prose-h1","props":{"class":"d-heading-title","id":"nuxt-を-google-cloud-run-へデプロイする"},"children":[{"type":"text","value":"Nuxt を Google Cloud Run へデプロイする"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{"class":"d-heading-description"},"children":[{"type":"text","value":"Nuxt を Google Cloud Run にどうやってデプロイするのか？"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-hr","props":{"class":"d-heading-hr"},"children":[]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"element","tag":"prose-a","props":{"href":"https://cloud.google.com/run","rel":["nofollow","noopener","noreferrer"],"target":"_blank"},"children":[{"type":"text","value":"Google Cloud Run"}]},{"type":"text","value":" はコンテナ化されたアプリケーションを迅速に安全にデプロイし、スケーリングするためのフルマネージド・コンピュータ・プラットフォームです。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"このガイドでは、簡単にプロジェクトのフォルダ全体を Dockerfile で Google Cloud Build にアップロードします。アップロードした後、Cloud Build は自動でコンテナを生成します。そしてコンテナを package.json の "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"start"}]},{"type":"text","value":" スクリプトで起動する、Google Cloud Run にデプロイします。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h2","props":{"id":"はじめに"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"},"children":[{"type":"text","value":"はじめに"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Google Cloud Account とプロジェクト、そしてエディターとして Cloud Build と Cloud Run にアクセス権があることを確認してください。さらに Google の"},{"type":"element","tag":"prose-a","props":{"href":"https://cloud.google.com/sdk/","rel":["nofollow","noopener","noreferrer"],"target":"_blank"},"children":[{"type":"text","value":"こちら"}]},{"type":"text","value":"で解説されている Cloud SDK (CLI) をダウンロードしてインストールし、Google Cloud Account でログインしてください。もし Cloud SDK をダウンロードしたくない場合、Google Cloud Console から gcloud CLI を使用することができます。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"いくつかチェックをしましょう！"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Cloud Build API と Cloud Run API が無効の場合、有効にします："}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"pre","props":{"className":["line-numbers","language-bash"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"# Cloud Build を有効にする"}]},{"type":"text","value":"\n$ gcloud services "},{"type":"element","tag":"span","props":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"enable"}]},{"type":"text","value":" cloudbuild.googleapis.com\n\n"},{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"# Cloud Run を有効にする"}]},{"type":"text","value":"\n$ gcloud services "},{"type":"element","tag":"span","props":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"enable"}]},{"type":"text","value":" run.googleapis.com\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Go in your application directory and install dependencies:"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"pre","props":{"className":["line-numbers","language-bash"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"# yarn ユーザー向け"}]},{"type":"text","value":"\n$ "},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"yarn"}]},{"type":"text","value":"\n\n"},{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"# npm ユーザー向け"}]},{"type":"text","value":"\n$ "},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"install"}]},{"type":"text","value":"\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Start the application locally:"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"pre","props":{"className":["line-numbers","language-bash"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"# yarn ユーザー向け"}]},{"type":"text","value":"\n$ "},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"yarn"}]},{"type":"text","value":" dev\n\n"},{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"# npm ユーザー向け"}]},{"type":"text","value":"\n$ "},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" run dev\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"全ての動作を確認します。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h2","props":{"id":"アプリケーションのコンテナ化"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E5%8C%96"},"children":[{"type":"text","value":"アプリケーションのコンテナ化"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"それでは、Cloud Build でコンテナを作成します。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Nuxt アプリケーションに "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"Dockerfile"}]},{"type":"text","value":" を追加する必要があります。 プロジェクトのルートディレクトリに "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"Dockerfile"}]},{"type":"text","value":" という名前の新しいファイルを作成し、以下の内容を追加してください："}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"yarn ユーザー向け："}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"pre","props":{"className":["line-numbers","language-text"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"FROM node:14\n\nWORKDIR /usr/src/app\n\nCOPY . ./\nRUN yarn\n\nEXPOSE 8080\n\nENV HOST=0.0.0.0\nENV PORT=8080\n\nRUN yarn build\n\nCMD [ \"yarn\", \"start\" ]\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"npm ユーザー向け："}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"pre","props":{"className":["line-numbers","language-text"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"FROM node:14\n\nWORKDIR /usr/src/app\n\nCOPY . ./\nRUN npm install\n\nEXPOSE 8080\n\nENV HOST=0.0.0.0\nENV PORT=8080\n\nRUN npm run build\n\nCMD [ \"npm\", \"run\", \"start\" ]\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"ビルドプロセスを開始するため、以下のコマンドを実行してください："}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"gcloud builds submit --tag gcr.io/<YOUR_GOOGLE_CLOUD_PROJECT_ID>/my-nuxt-app-name:1.0.0 ."}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"!注意: もし継続的デリバリーや .env ファイルでの設定を実装したい場合、"},{"type":"element","tag":"prose-a","props":{"href":"https://cloud.google.com/cloud-build/docs/build-config","rel":["nofollow","noopener","noreferrer"],"target":"_blank"},"children":[{"type":"text","value":"Cloud Build 構成ファイル"}]},{"type":"text","value":" を使用する必要があります。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h2","props":{"id":"cloud-run-へのアプリケーションのデプロイ"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#cloud-run-%E3%81%B8%E3%81%AE%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4"},"children":[{"type":"text","value":"Cloud Run へのアプリケーションのデプロイ"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"アプリケーションをデプロイするため以下のコマンドを実行してください："}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"gcloud run deploy --image=gcr.io/<YOUR_GOOGLE_CLOUD_PROJECT_ID>/my-nuxt-app-name:1.0.0 --platform managed --port 3000"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"パブリックアクセスの設定を行いたい場合、認証されていない起動を許可します。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Cloud Run アプリケーションのデフォルトの同時実行値は 80 であることに注意してください（各コンテナ・インスタンスは、一度に最大 80 のリクエストを処理します）。このようにして同時実行値を指定することができます："}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"gcloud run deploy --image=gcr.io/<YOUR_GOOGLE_CLOUD_PROJECT_ID>/my-nuxt-app-name:1.0.0 --platform managed --port 3000 --concurrency <YOUR_CONCURRENCY_VALUE>"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"デプロイメントの作成に成功しているか確認するため、以下のコマンドを実行してください："}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"gcloud run services list --platform managed"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Cloud Run サービスのリストが表示されます。デプロイした URL をクリックし、結果をお楽しみください！"}]}]},"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"はじめに","depth":2,"text":"はじめに"},{"id":"アプリケーションのコンテナ化","depth":2,"text":"アプリケーションのコンテナ化"},{"id":"cloud-run-へのアプリケーションのデプロイ","depth":2,"text":"Cloud Run へのアプリケーションのデプロイ"}]}}}