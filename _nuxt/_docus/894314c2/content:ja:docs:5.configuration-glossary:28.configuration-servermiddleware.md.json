{"key":"content:ja:docs:5.configuration-glossary:28.configuration-servermiddleware.md","generatedAt":"2022-03-15T12:18:30.040Z","mtime":"2022-03-15T12:18:30.025Z","slug":"configuration-servermiddleware","title":"serverMiddleware プロパティ","position":"999900050028","to":"/docs/configuration-glossary/configuration-servermiddleware","draft":false,"page":true,"language":"ja","navigation":{"title":"serverMiddleware"},"description":"サーバーサイドミドルウェアを定義します。","menu":"serverMiddleware","category":"configuration-glossary","empty":false,"body":{"raw":"---\ntitle: serverMiddleware プロパティ\nnavigation.title: serverMiddleware\ndescription: サーバーサイドミドルウェアを定義します。\nmenu: serverMiddleware\ncategory: configuration-glossary\n---\n# serverMiddleware プロパティ\n\nサーバーサイドミドルウェアを定義します。\n\n---\n\n- 型: `Array`\n  - 要素: `String` または `Object` または `Function`\n\nNuxt はカスタムミドルウェアを追加できる [connect](https://github.com/senchalabs/connect) インスタンスを内部で作ります。これにより**外部サーバーを必要とせずに**通常は `/api` ルート）を登録できます。\n\nconnect 自体はミドルウェアなので、登録されたミドルウェアは `nuxt start` と [express-template](https://github.com/nuxt-community/express-template) のようなプログラムで使われるミドルウェアとして使う場合の両方で動作します。Nuxt [モジュール](/docs/directory-structure/modules)もまた [this.addServerMiddleware()](/docs/internals-glossary/internals-module-container#addservermiddleware-middleware) を使って `serverMiddleware` を提供できます。\n\nそれらに加え、デフォルト値が `true` の `prefix` オプションを導入しました。サーバーミドルウェアに router base を追加します。\n\n**例:**\n\n- サーバーミドルウェアパス: `/server-middleware`\n- Router base: `/admin`\n- `prefix: true` の場合（デフォルト）: `/admin/server-middleware`\n- `prefix: false` の場合: `/server-middleware`\n\n## サーバーミドルウェア vs ミドルウェア！\n\nクライアントサイドやサーバーサイドレンダリングで Vue によって各ルートの前に呼び出される[ルートのミドルウェア](/docs/directory-structure/middleware)と混同しないでください。 `serverMiddleware` プロパティに列挙されているミドルウェアは `vue-server-renderer` の**前**にサーバーサイドで実行され、API リクエストの処理やアセットの提供などのサーバー固有のタスクに使用できます。\n\n::alert{type=\"warning\"}\nサーバーミドルウェアを middleware/ ディレクトリに追加しないでください。\n\nミドルウェアは webpack によって本番バンドルにバンドルされ beforeRouteEnter で実行されます。serverMiddleware を middleware/ ディレクトリに追加すると、Nuxt によってミドルウェアとして誤って選択され、誤った依存関係がバンドルに追加されたり、エラーが発生したりします。\n::\n\n## 使い方\n\nもしミドルウェアが文字列の場合、 Nuxt はそのミドルウェアを自動的に解決し要求します。\n\n```js{}[nuxt.config.js]\nimport serveStatic from 'serve-static'\n\nexport default {\n  serverMiddleware: [\n    // redirect-ssl npm パッケージを登録します\n    'redirect-ssl',\n\n    // /server-middleware/* を処理するために、プロジェクトの server-middleware ディレクトリからファイルを登録します\n    { path: '/server-middleware', handler: '~/server-middleware/index.js' },\n\n    // カスタムインスタンスを作成することもできます\n    { path: '/static2', handler: serveStatic(__dirname + '/static2') }\n  ]\n}\n```\n\n::alert{type=\"warning\"}\nもしミドルウェアをすべてのルートに登録したくない場合は、特定のパスでオブジェクトフォームを使用する必要があります。 そうしないと nuxt のデフォルトハンドラは機能しません。\n::\n\n## カスタムサーバーミドルウェア\n\nカスタムミドルウェアの作成も可能です。詳細については [Connect Docs](https://github.com/senchalabs/connect#appusefn) を参照してください。\n\nミドルウェア（`server-middleware/logger.js`）:\n\n```js{}[server-middleware/logger.js]\nexport default function (req, res, next) {\n  // req は Node.js の HTTP リクエストオブジェクトです\n  console.log(req.url)\n\n  // res は Node.js の HTTP レスポンスオブジェクトです\n\n  // next は 次のミドルウェアを呼び出すための関数です。\n  // ミドルウェアがエンドポイントでない場合、関数の最後で next を呼び出すのを忘れないでください！\n  next()\n}\n```\n\n```js{}[nuxt.config.js]\nserverMiddleware: ['~/server-middleware/logger']\n```\n\n## カスタム API エンドポイント\n\nサーバーミドルウェアも Express を拡張できます。これにより REST エンドポイントを作成できます。\n\n```js{}[server-middleware/rest.js]\nconst bodyParser = require('body-parser')\nconst app = require('express')()\n\napp.use(bodyParser.json())\napp.all('/getJSON', (req, res) => {\n  res.json({ data: 'data' })\n})\n\nmodule.exports = app\n```\n\n```js{}[nuxt.config.js]\nserverMiddleware: [\n  { path: \"/server-middleware\", handler: \"~/server-middleware/rest.js\" },\n],\n```\n\n## オブジェクトの構文\n\nパスにマッピングされた関数のリストでサーバーミドルウェアが構成されている場合：\n\n```js\nexport default {\n  serverMiddleware: [\n    { path: '/a', handler: '~/server-middleware/a.js' },\n    { path: '/b', handler: '~/server-middleware/b.js' },\n    { path: '/c', handler: '~/server-middleware/c.js' }\n  ]\n}\n```\n\nあるいは、次のとおりオブジェクトを渡して定義することもできます：\n\n```js\nexport default {\n  serverMiddleware: {\n    '/a': '~/server-middleware/a.js',\n    '/b': '~/server-middleware/b.js',\n    '/c': '~/server-middleware/c.js'\n  }\n}\n```\n","ast":{"type":"root","children":[{"type":"element","tag":"prose-h1","props":{"class":"d-heading-title","id":"servermiddleware-プロパティ"},"children":[{"type":"text","value":"serverMiddleware プロパティ"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{"class":"d-heading-description"},"children":[{"type":"text","value":"サーバーサイドミドルウェアを定義します。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-hr","props":{"class":"d-heading-hr"},"children":[]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-ul","props":{},"children":[{"type":"text","value":"\n"},{"type":"element","tag":"prose-li","props":{},"children":[{"type":"text","value":"\n"},{"type":"text","value":"型: "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"Array"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-ul","props":{},"children":[{"type":"text","value":"\n"},{"type":"element","tag":"prose-li","props":{},"children":[{"type":"text","value":"\n"},{"type":"text","value":"要素: "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" または "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"Object"}]},{"type":"text","value":" または "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"Function"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Nuxt はカスタムミドルウェアを追加できる "},{"type":"element","tag":"prose-a","props":{"href":"https://github.com/senchalabs/connect","rel":["nofollow","noopener","noreferrer"],"target":"_blank"},"children":[{"type":"text","value":"connect"}]},{"type":"text","value":" インスタンスを内部で作ります。これにより"},{"type":"element","tag":"prose-strong","props":{},"children":[{"type":"text","value":"外部サーバーを必要とせずに"}]},{"type":"text","value":"通常は "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"/api"}]},{"type":"text","value":" ルート）を登録できます。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"connect 自体はミドルウェアなので、登録されたミドルウェアは "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"nuxt start"}]},{"type":"text","value":" と "},{"type":"element","tag":"prose-a","props":{"href":"https://github.com/nuxt-community/express-template","rel":["nofollow","noopener","noreferrer"],"target":"_blank"},"children":[{"type":"text","value":"express-template"}]},{"type":"text","value":" のようなプログラムで使われるミドルウェアとして使う場合の両方で動作します。Nuxt "},{"type":"element","tag":"prose-a","props":{"href":"/docs/directory-structure/modules"},"children":[{"type":"text","value":"モジュール"}]},{"type":"text","value":"もまた "},{"type":"element","tag":"prose-a","props":{"href":"/docs/internals-glossary/internals-module-container#addservermiddleware-middleware"},"children":[{"type":"text","value":"this.addServerMiddleware()"}]},{"type":"text","value":" を使って "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"serverMiddleware"}]},{"type":"text","value":" を提供できます。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"それらに加え、デフォルト値が "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"true"}]},{"type":"text","value":" の "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"prefix"}]},{"type":"text","value":" オプションを導入しました。サーバーミドルウェアに router base を追加します。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"element","tag":"prose-strong","props":{},"children":[{"type":"text","value":"例:"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-ul","props":{},"children":[{"type":"text","value":"\n"},{"type":"element","tag":"prose-li","props":{},"children":[{"type":"text","value":"\n"},{"type":"text","value":"サーバーミドルウェアパス: "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"/server-middleware"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-li","props":{},"children":[{"type":"text","value":"\n"},{"type":"text","value":"Router base: "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"/admin"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-li","props":{},"children":[{"type":"text","value":"\n"},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"prefix: true"}]},{"type":"text","value":" の場合（デフォルト）: "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"/admin/server-middleware"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-li","props":{},"children":[{"type":"text","value":"\n"},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"prefix: false"}]},{"type":"text","value":" の場合: "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"/server-middleware"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h2","props":{"id":"サーバーミドルウェア-vs-ミドルウェア！"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%83%9F%E3%83%89%E3%83%AB%E3%82%A6%E3%82%A7%E3%82%A2-vs-%E3%83%9F%E3%83%89%E3%83%AB%E3%82%A6%E3%82%A7%E3%82%A2%EF%BC%81"},"children":[{"type":"text","value":"サーバーミドルウェア vs ミドルウェア！"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"クライアントサイドやサーバーサイドレンダリングで Vue によって各ルートの前に呼び出される"},{"type":"element","tag":"prose-a","props":{"href":"/docs/directory-structure/middleware"},"children":[{"type":"text","value":"ルートのミドルウェア"}]},{"type":"text","value":"と混同しないでください。 "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"serverMiddleware"}]},{"type":"text","value":" プロパティに列挙されているミドルウェアは "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"vue-server-renderer"}]},{"type":"text","value":" の"},{"type":"element","tag":"prose-strong","props":{},"children":[{"type":"text","value":"前"}]},{"type":"text","value":"にサーバーサイドで実行され、API リクエストの処理やアセットの提供などのサーバー固有のタスクに使用できます。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"alert","props":{"type":"warning"},"children":[{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"サーバーミドルウェアを middleware/ ディレクトリに追加しないでください。"}]},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"ミドルウェアは webpack によって本番バンドルにバンドルされ beforeRouteEnter で実行されます。serverMiddleware を middleware/ ディレクトリに追加すると、Nuxt によってミドルウェアとして誤って選択され、誤った依存関係がバンドルに追加されたり、エラーが発生したりします。"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h2","props":{"id":"使い方"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#%E4%BD%BF%E3%81%84%E6%96%B9"},"children":[{"type":"text","value":"使い方"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"もしミドルウェアが文字列の場合、 Nuxt はそのミドルウェアを自動的に解決し要求します。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"nuxt.config.js"}]},{"type":"element","tag":"pre","props":{"className":["language-js","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"import"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","imports"]},"children":[{"type":"text","value":"serveStatic"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"from"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'serve-static'"}]},{"type":"text","value":"\n\n"},{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"export"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"default"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  serverMiddleware"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":"\n    "},{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"// redirect-ssl npm パッケージを登録します"}]},{"type":"text","value":"\n    "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'redirect-ssl'"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n\n    "},{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"// /server-middleware/* を処理するために、プロジェクトの server-middleware ディレクトリからファイルを登録します"}]},{"type":"text","value":"\n    "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" path"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'/server-middleware'"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" handler"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'~/server-middleware/index.js'"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n\n    "},{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"// カスタムインスタンスを作成することもできます"}]},{"type":"text","value":"\n    "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" path"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'/static2'"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" handler"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"serveStatic"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"__dirname "},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":"+"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'/static2'"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"alert","props":{"type":"warning"},"children":[{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"もしミドルウェアをすべてのルートに登録したくない場合は、特定のパスでオブジェクトフォームを使用する必要があります。 そうしないと nuxt のデフォルトハンドラは機能しません。"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h2","props":{"id":"カスタムサーバーミドルウェア"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%83%9F%E3%83%89%E3%83%AB%E3%82%A6%E3%82%A7%E3%82%A2"},"children":[{"type":"text","value":"カスタムサーバーミドルウェア"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"カスタムミドルウェアの作成も可能です。詳細については "},{"type":"element","tag":"prose-a","props":{"href":"https://github.com/senchalabs/connect#appusefn","rel":["nofollow","noopener","noreferrer"],"target":"_blank"},"children":[{"type":"text","value":"Connect Docs"}]},{"type":"text","value":" を参照してください。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"ミドルウェア（"},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"server-middleware/logger.js"}]},{"type":"text","value":"）:"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"server-middleware/logger.js"}]},{"type":"element","tag":"pre","props":{"className":["language-js","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"export"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"default"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","keyword"]},"children":[{"type":"text","value":"function"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"className":["token","parameter"]},"children":[{"type":"text","value":"req"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" res"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" next"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"// req は Node.js の HTTP リクエストオブジェクトです"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"span","props":{"className":["token","console","class-name"]},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"className":["token","method","function","property-access"]},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"req"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"className":["token","property-access"]},"children":[{"type":"text","value":"url"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n  "},{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"// res は Node.js の HTTP レスポンスオブジェクトです"}]},{"type":"text","value":"\n\n  "},{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"// next は 次のミドルウェアを呼び出すための関数です。"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"span","props":{"className":["token","comment"]},"children":[{"type":"text","value":"// ミドルウェアがエンドポイントでない場合、関数の最後で next を呼び出すのを忘れないでください！"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"nuxt.config.js"}]},{"type":"element","tag":"pre","props":{"className":["language-js","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"serverMiddleware"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'~/server-middleware/logger'"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h2","props":{"id":"カスタム-api-エンドポイント"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0-api-%E3%82%A8%E3%83%B3%E3%83%89%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88"},"children":[{"type":"text","value":"カスタム API エンドポイント"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"サーバーミドルウェアも Express を拡張できます。これにより REST エンドポイントを作成できます。"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"server-middleware/rest.js"}]},{"type":"element","tag":"pre","props":{"className":["language-js","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" bodyParser "},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"require"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'body-parser'"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tag":"span","props":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" app "},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"require"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'express'"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\napp"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"className":["token","method","function","property-access"]},"children":[{"type":"text","value":"use"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"bodyParser"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"className":["token","method","function","property-access"]},"children":[{"type":"text","value":"json"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\napp"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"className":["token","method","function","property-access"]},"children":[{"type":"text","value":"all"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'/getJSON'"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"className":["token","parameter"]},"children":[{"type":"text","value":"req"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" res"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","arrow","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  res"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"className":["token","method","function","property-access"]},"children":[{"type":"text","value":"json"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" data"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'data'"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\nmodule"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"className":["token","property-access"]},"children":[{"type":"text","value":"exports"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" app\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"nuxt.config.js"}]},{"type":"element","tag":"pre","props":{"className":["language-js","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"serverMiddleware"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":"\n  "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" path"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"\"/server-middleware\""}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" handler"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"\"~/server-middleware/rest.js\""}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h2","props":{"id":"オブジェクトの構文"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E6%A7%8B%E6%96%87"},"children":[{"type":"text","value":"オブジェクトの構文"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"パスにマッピングされた関数のリストでサーバーミドルウェアが構成されている場合："}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"pre","props":{"className":["language-js","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"export"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"default"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  serverMiddleware"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":"\n    "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" path"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'/a'"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" handler"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'~/server-middleware/a.js'"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n    "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" path"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'/b'"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" handler"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'~/server-middleware/b.js'"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n    "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" path"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'/c'"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" handler"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'~/server-middleware/c.js'"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"あるいは、次のとおりオブジェクトを渡して定義することもできます："}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"pre","props":{"className":["language-js","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"export"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","keyword","module"]},"children":[{"type":"text","value":"default"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  serverMiddleware"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'/a'"}]},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'~/server-middleware/a.js'"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n    "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'/b'"}]},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'~/server-middleware/b.js'"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n    "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'/c'"}]},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'~/server-middleware/c.js'"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"}]}]}]}]},"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"サーバーミドルウェア-vs-ミドルウェア！","depth":2,"text":"サーバーミドルウェア vs ミドルウェア！"},{"id":"使い方","depth":2,"text":"使い方"},{"id":"カスタムサーバーミドルウェア","depth":2,"text":"カスタムサーバーミドルウェア"},{"id":"カスタム-api-エンドポイント","depth":2,"text":"カスタム API エンドポイント"},{"id":"オブジェクトの構文","depth":2,"text":"オブジェクトの構文"}]}}}